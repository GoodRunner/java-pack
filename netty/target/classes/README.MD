#### TCP的粘包和拆包

> 这个包里展示了TCP发送消息的粘包和拆包问题, 其中show包里面是演示tcp会发生粘包和拆包现象, solve包中是解决这个问题

1. 粘包和拆包的原理解释

TCP请求的时候是以流动的方式传输数据，传输的最小单位是报文段（segment）.TCP HEADER中有一个`Options`标识位，mss(Maximum Segment Size最大消息长度) 常见的标识连接层每次传输的数据有个最大限制MTU(Maximum Transmission Unit)，一般是1500比特，超过这个量要分成多个报文段，mss则是这个最大限制减去TCP的header，光是要传输的数据的大小，一般为1460比特。换算成字节，也就是180多字节。
MSS = MTU - header 
tcp为提高性能，发送端会将需要发送的数据发送到缓冲区，等待缓冲区满了之后，再将缓冲中的数据发送到接收方。同理，接收方也有缓冲区这样的机制，来接收数据。
发生TCP粘包、拆包主要是由于下面一些原因：  
应用程序写入的数据大于套接字缓冲区大小，这将会发生拆包。  
应用程序写入数据小于套接字缓冲区大小，网卡将应用多次写入的数据发送到网络上，这将会发生粘包。  
进行mss（最大报文长度）大小的TCP分段，当TCP报文长度-TCP头部长度>mss的时候将发生拆包。  
接收方法不及时读取套接字缓冲区数据，这将发生粘包。  


2. 一般解决方法

    自定义协议 + 自定义编解码器  
    设置定长消息，服务端每次读取既定长度的内容作为一条完整消息。  
    设置消息边界，服务端从网络流中按消息编辑分离出消息内容。  